# Технологии и архитектура

## Технологический стек
- Bun + TypeScript — основа приложения и управления зависимостями.
- Клиент Telegram Bot API (например, `grammy`) для работы с ботом.
- HTTP-клиент (fetch встроенный в Bun) для обращения к Twitter/X API или сторонним сервисам извлечения.
- OAuth 1.0a авторизация Twitter/X при помощи Consumer/Access ключей из окружения и прокси.
- Библиотека для обработки медиа (ffmpeg через CLI) при необходимости конвертации видео.

## Архитектурные принципы
- **Vertical Slice / Screaming Architecture** — код структурируется по пользовательским сценариям, а не по техническим слоям.
- Каждый срез включает собственные модули домена, адаптеров, инфраструктуры и интерфейсов.
- Настройки и общие сервисы оформляются как отдельные cross-cutting пакеты.

## Структура проекта
```
src/
  app/                # Точка входа, конфигурация бота, DI
  slices/
    publish-post/     # Основной вертикальный срез публикации
      application/    # Юзкейсы и оркестрация
      domain/         # Доменные модели, сущности и правила
      infrastructure/ # Интеграции с Twitter, Telegram, хранилищем файлов
      presentation/   # Мапперы входящих команд и формирование сообщений
  shared/
    config/           # Загрузка переменных окружения
    logging/          # Логирование и обработка ошибок
    storage/          # Работа с временными файлами
```

## Поток обработки
1. Модуль `presentation` принимает команду пользователя и валидирует данные.
2. `application` вызывает доменный сценарий публикации.
3. `domain` определяет правила работы с медиа и текстом.
4. `infrastructure` скачивает вложения, готовит медиа и отправляет сообщение в Telegram.
5. `shared` модули предоставляют конфигурацию, логирование и управление файлами.

## Реализованные компоненты
- `src/app/main.ts` — загрузка `.env`, инициализация `grammy`, регистрация обработчиков, проверка авторизации.
- `src/shared/config/env.ts` — чтение переменных окружения и подготовка временного каталога.
- `src/shared/storage/temp-file-manager.ts` — генерация временных путей, запись и очистка файлов.
- `src/shared/logging/logger.ts` — форматированный вывод логов.
- `src/slices/publish-post/presentation/telegram-handler.ts` — обработка команды `/post`, валидация данных и ответы пользователю.
- `src/slices/publish-post/application/publish-post.use-case.ts` — оркестрация скачивания и публикации медиаконтента.
- `src/slices/publish-post/infrastructure/twitter-media-downloader.ts` — загрузка вложений из Twitter/X через прокси и сохранение во временные файлы.
- `src/slices/publish-post/infrastructure/telegram-channel-publisher.ts` — отправка медиа-групп и plain-text ссылок в Telegram-канал.
